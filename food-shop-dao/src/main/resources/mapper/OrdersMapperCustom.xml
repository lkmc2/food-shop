<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lin.dao.OrdersMapperCustom" >

  <resultMap id="myOrdersVO" type="com.lin.vo.MyOrderVO">
    <id column="orderId" property="orderId"/>
    <result column="create_time" property="createTime"/>
    <result column="pay_method" property="payMethod"/>
    <result column="real_pay_amount" property="realPayAmount"/>
    <result column="post_amount" property="postAmount"/>

    <collection property="subOrderItemList" ofType="com.lin.vo.MySubOrderItemVO">
      <id column="item_id" property="itemId"/>
      <result column="item_name" property="itemName"/>
      <result column="item_img" property="itemImg"/>
      <result column="item_spec_id" property="itemSpecId"/>
      <result column="item_spec_name" property="itemSpecName"/>
      <result column="buy_counts" property="buyCounts"/>
      <result column="price" property="price"/>
    </collection>
  </resultMap>

  <select id="queryMyOrders" resultMap="myOrdersVO">
    select
        od.id as orderId,
        od.create_time,
        od.pay_method,
        od.real_pay_amount,
        od.post_amount,
        status.order_status,
        item.item_id,
        item.item_name,
        item.item_img,
        item.item_spec_id,
        item.item_spec_name,
        item.buy_counts,
        item.price
    from orders od
    left join order_status status on od.id = status.order_id
    left join order_items item on od.id = status.order_id
    where od.user_id = #{userId, jdbcType=VARCHAR}
    <if test="orderStatus != null">
      and od.is_delete = #{orderStatus, jdbcType=INTEGER}
    </if>
    order by od.update_time
  </select>

</mapper>